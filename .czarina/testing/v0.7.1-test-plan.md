# v0.7.1 Integration Test Plan

**Version:** 0.7.1
**Created:** 2025-12-28
**Owner:** integration-testing worker
**Status:** Initial Draft

## Executive Summary

This test plan validates the three critical UX fixes for Czarina v0.7.1:
1. **Worker Onboarding Fix** - Eliminate stuck workers during launch
2. **Autonomous Czar Daemon** - Enable true autonomous orchestration
3. **One-Command Launch** - Reduce launch friction from 8 steps to 1

**Success Target:** Achieve measurable improvement in all three areas with real orchestrations.

---

## Test Matrix

| Feature | Baseline (Before) | Target (After) | Success Criteria | Priority |
|---------|-------------------|----------------|------------------|----------|
| **Worker Onboarding** | 1 stuck per orchestration | 0 stuck workers | âœ“ 0 stuck workers observed | P0 |
| **Czar Autonomy** | Manual coordination required | Autonomous operation | âœ“ 0 manual interventions | P0 |
| **Launch Time** | 10+ min, 8 manual steps | <60s, 1 command | âœ“ <60 seconds total | P1 |

---

## Test Scenario 1: Worker Onboarding Fix

### Background
**Problem:** Workers consistently get stuck after launch - don't know their first action
**Root Cause:** Worker identity files lack explicit "YOUR FIRST ACTION" section
**Fix:** Add prominent first action callout to all worker identities

### Test Objectives
- Verify workers take immediate action after launch
- Measure time to first action
- Count stuck workers (target: 0)
- Validate first action clarity

### Test Setup
```bash
# Create test orchestration with updated worker identities
# Ensure all identities have "ðŸš€ YOUR FIRST ACTION" section
# Launch all workers
# Observe first 10 minutes of operation
```

### Test Procedure

#### Step 1: Pre-Launch Validation
- [ ] Review all worker identity files
- [ ] Verify each has "ðŸš€ YOUR FIRST ACTION" section
- [ ] Confirm first action is specific and actionable
- [ ] Check for clear completion criteria

#### Step 2: Launch Workers
- [ ] Launch orchestration with all Phase 1 workers
- [ ] Note exact launch timestamp for each worker
- [ ] Observe initial behavior in tmux windows

#### Step 3: Monitor First Actions
For each worker, record:
- [ ] Time to first tool use (Read, Bash, etc.)
- [ ] Was first action correct? (matches identity)
- [ ] Did worker get stuck or confused?
- [ ] Was human intervention needed?

#### Step 4: Data Collection
Create table in test results:
```markdown
| Worker ID | Launch Time | First Action Time | Delta | Stuck? | Intervention? |
|-----------|-------------|-------------------|-------|--------|---------------|
| worker-1  | 10:00:00   | 10:00:45         | 45s   | No     | No            |
| worker-2  | 10:00:05   | 10:01:20         | 75s   | No     | No            |
```

### Success Criteria
- âœ… **0 workers stuck** (down from 1 per orchestration)
- âœ… **100% workers take first action within 2 minutes**
- âœ… **0 human interventions needed** to start workers
- âœ… **Average time to first action <90 seconds**

### Failure Modes to Watch
- Worker reads identity but doesn't act
- Worker asks "what should I do?" or similar
- Worker explores codebase without taking action
- Worker needs human nudge to proceed

### Metrics to Capture
- Time to first action (per worker)
- Number of stuck workers
- Number of human interventions
- Worker confidence (subjective 1-5 rating)

---

## Test Scenario 2: Autonomous Czar Daemon

### Background
**Problem:** Czar is passive - humans must manually coordinate workers
**Root Cause:** No autonomous monitoring/coordination loop
**Fix:** Implement bash-based autonomous Czar daemon

### Test Objectives
- Verify Czar monitors workers automatically
- Confirm Czar detects phase completion
- Validate Czar launches Phase 2 workers autonomously
- Measure manual interventions (target: 0)

### Test Setup
```bash
# Launch orchestration with autonomous Czar daemon
# Czar should run in background, monitoring workers
# Phase 1 workers should complete
# Czar should auto-transition to Phase 2
```

### Test Procedure

#### Step 1: Daemon Launch
- [ ] Launch orchestration with Czar daemon enabled
- [ ] Verify daemon running in tmux window
- [ ] Check daemon logs exist and are being written
- [ ] Confirm monitoring loop is active

#### Step 2: Worker Monitoring
Observe Czar behavior every 5 minutes:
- [ ] Does Czar check worker status?
- [ ] Does Czar log worker progress?
- [ ] Does Czar detect stuck workers?
- [ ] Does Czar send nudges if needed?

#### Step 3: Phase Transition
When Phase 1 completes:
- [ ] Does Czar detect all workers complete?
- [ ] Does Czar log phase completion?
- [ ] Does Czar automatically launch Phase 2 workers?
- [ ] Does Czar respect dependencies?

#### Step 4: Dependency Coordination
- [ ] Czar waits for dependency completion before launch
- [ ] Czar notifies dependent workers when ready
- [ ] Czar handles partial phase completion correctly

#### Step 5: Manual Intervention Tracking
Record every time human intervenes:
```markdown
| Timestamp | Intervention | Reason | Should Czar Have Done This? |
|-----------|-------------|--------|------------------------------|
| 10:30:00  | Checked status | Curious | Yes - should auto-log |
```

### Success Criteria
- âœ… **Czar daemon runs continuously** without crashing
- âœ… **Czar monitors workers every 5 minutes** (logged)
- âœ… **Czar auto-transitions Phase 1 â†’ Phase 2**
- âœ… **0 manual interventions required** for coordination
- âœ… **100% dependency coordination automated**

### Failure Modes to Watch
- Daemon crashes or stops running
- Daemon doesn't detect phase completion
- Daemon launches Phase 2 workers prematurely
- Daemon misses dependency requirements
- Human has to manually check worker status
- Human has to manually launch Phase 2

### Metrics to Capture
- Daemon uptime (should be 100%)
- Monitoring frequency (should be every 5 min)
- Phase transition time (from last worker complete to Phase 2 launch)
- Number of manual interventions
- Number of Czar actions logged

---

## Test Scenario 3: One-Command Launch

### Background
**Problem:** Launch requires 8 manual steps taking 10+ minutes
**Root Cause:** No automated pipeline from plan â†’ running orchestration
**Fix:** Implement `czarina analyze plan.md --go` for one-command launch

### Test Objectives
- Verify one-command launch works end-to-end
- Measure total launch time
- Validate config generation accuracy
- Test error handling

### Test Setup
```bash
# Create test plan in standard format
# Have previous orchestration to close
# Run: czarina analyze plan.md --go
# Measure time from command to workers running
```

### Test Procedure

#### Step 1: Preparation
- [ ] Create test plan file (or use existing)
- [ ] Ensure previous orchestration exists (to test phase close)
- [ ] Clear any blocking state

#### Step 2: Execute One-Command Launch
```bash
# Start timer
time czarina analyze INTEGRATION_PLAN_v0.7.1.md --go

# Should complete:
# 1. Parse plan
# 2. Close previous phase
# 3. Generate config
# 4. Generate worker identities
# 5. Validate config
# 6. Init branches
# 7. Create worktrees
# 8. Launch tmux session
# 9. Start workers
```

#### Step 3: Validation Checkpoints
After launch completes:
- [ ] Config.json exists and is valid
- [ ] All worker identity files created
- [ ] Git branches created with correct naming
- [ ] Worktrees created in correct locations
- [ ] Tmux session running
- [ ] All workers launched and active
- [ ] Czar daemon running (if enabled)

#### Step 4: Time Measurement
Record detailed timing:
```markdown
| Step | Start | End | Duration |
|------|-------|-----|----------|
| Parse plan | 0s | 2s | 2s |
| Close phase | 2s | 5s | 3s |
| Generate config | 5s | 7s | 2s |
| Generate identities | 7s | 12s | 5s |
| Validate | 12s | 13s | 1s |
| Init branches | 13s | 20s | 7s |
| Create worktrees | 20s | 35s | 15s |
| Launch tmux | 35s | 40s | 5s |
| Start workers | 40s | 55s | 15s |
| **TOTAL** | | | **55s** |
```

#### Step 5: Error Handling Tests
Test failure scenarios:
- [ ] Invalid plan format
- [ ] Missing required fields
- [ ] Git conflicts
- [ ] Branch naming errors
- [ ] Worktree creation failures

### Success Criteria
- âœ… **Total launch time <60 seconds** (down from 10+ min)
- âœ… **Single command execution** (down from 8 steps)
- âœ… **0 manual interventions** during launch
- âœ… **100% success rate** with valid plans
- âœ… **Clear error messages** for invalid plans

### Failure Modes to Watch
- Launch hangs or times out
- Config generation errors
- Branch naming issues
- Worktree conflicts
- Worker launch failures
- Partial launches (some workers don't start)

### Metrics to Capture
- Total launch time (wall clock)
- Time per step
- Success rate (successful launches / attempts)
- Error rate by category
- User satisfaction (subjective)

---

## Test Scenario 4: End-to-End Integration

### Objective
Validate all three fixes working together in a real orchestration.

### Test Procedure

#### Step 1: One-Command Launch
- [ ] Use `czarina analyze plan.md --go`
- [ ] Measure launch time
- [ ] Verify all workers start

#### Step 2: Worker Onboarding
- [ ] Observe all workers take first action immediately
- [ ] Count stuck workers (should be 0)
- [ ] No human intervention needed

#### Step 3: Autonomous Coordination
- [ ] Czar monitors workers automatically
- [ ] Czar detects Phase 1 completion
- [ ] Czar launches Phase 2 autonomously
- [ ] No manual coordination needed

#### Step 4: Complete Orchestration
- [ ] Let orchestration run to completion
- [ ] Track all manual interventions
- [ ] Measure total orchestration time
- [ ] Document any issues encountered

### Success Criteria
- âœ… **Launch <60s** (one-command)
- âœ… **0 stuck workers** (onboarding fix)
- âœ… **0 manual interventions** (autonomous Czar)
- âœ… **Orchestration completes successfully**
- âœ… **All workers deliver on objectives**

---

## Test Environment

### Repository Setup
- Clean Czarina installation
- Test branch: `cz1/feat/integration-testing`
- Test plans in `.czarina/testing/test-plans/`

### Prerequisites
- Czarina v0.7.1+ installed
- Git configured correctly
- Tmux available
- Claude Code installed
- Sufficient API credits

### Test Data
- Test plan files (small, medium, large)
- Sample worker configurations
- Reference orchestration logs

---

## Test Execution Schedule

### Phase 1: Individual Feature Testing (Days 1-2)
- Test Scenario 1: Worker Onboarding (as fix lands)
- Test Scenario 2: Autonomous Czar (as fix lands)
- Test Scenario 3: One-Command Launch (as fix lands)

### Phase 2: Integration Testing (Day 3)
- Test Scenario 4: E2E integration
- Regression testing
- Performance validation

### Phase 3: Validation & Reporting (Day 4)
- Analyze all test results
- Create metrics dashboard
- Write test report
- File bug reports if needed

---

## Success Criteria Summary

### Worker Onboarding Fix
- [ ] 0 stuck workers (baseline: 1 per orchestration)
- [ ] Time to first action <90s average
- [ ] 0 human interventions to start workers

### Autonomous Czar Daemon
- [ ] Czar monitors continuously (every 5 min)
- [ ] Automatic phase transition
- [ ] 0 manual coordination actions

### One-Command Launch
- [ ] Launch time <60s (baseline: 10+ min)
- [ ] Single command (baseline: 8 steps)
- [ ] 100% success rate with valid plans

### Overall Integration
- [ ] All 3 features tested with real orchestrations
- [ ] E2E test validates fixes working together
- [ ] Metrics show clear improvement
- [ ] Test report documents all results

---

## Deliverables

1. **Test Results Documents**
   - Worker onboarding test results
   - Autonomous Czar test results
   - One-command launch test results
   - E2E integration test results

2. **Metrics Dashboard**
   - Before/after comparison
   - Time series data
   - Success rate graphs
   - Improvement percentage

3. **Test Report**
   - Executive summary
   - Detailed findings
   - Success criteria validation
   - Recommendations

4. **Bug Reports**
   - Issues found during testing
   - Severity classification
   - Reproduction steps
   - Suggested fixes

---

## Risk Assessment

### High Risk Items
- **Autonomous Czar may not detect phase completion correctly**
  - Mitigation: Test with multiple phase transitions
  - Fallback: Manual phase transition as backup

- **One-command launch may fail with edge cases**
  - Mitigation: Test various plan formats
  - Fallback: Keep manual launch process available

### Medium Risk Items
- **Worker onboarding fix may not work for all worker types**
  - Mitigation: Test with diverse worker roles

- **Test orchestrations may not reflect real-world usage**
  - Mitigation: Use actual v0.7.1 plan for testing

### Low Risk Items
- **Timing measurements may be inconsistent**
  - Mitigation: Multiple test runs, average results

---

## Test Data Retention

- All test logs saved to `.czarina/testing/logs/`
- Git commits tagged with test run IDs
- Metrics exported to `.czarina/testing/metrics/`
- Screenshots/recordings for critical tests

---

## Notes

- **Test continuously** as features land - don't wait until end
- **Document everything** - before/after comparisons crucial
- **Use real orchestrations** - not mocks or simulations
- **Be thorough** - this validates the entire v0.7.1 effort
- **Metrics must show clear improvement** - numbers don't lie

---

## References

- Issue: `.czarina/hopper/issue-worker-onboarding-confusion.md`
- Issue: `.czarina/hopper/issue-czar-not-autonomous.md`
- Enhancement: `.czarina/hopper/enhancement-one-command-launch.md`
- Integration Plan: `INTEGRATION_PLAN_v0.7.1.md`

---

**Next Steps:**
1. Review and refine this test plan
2. Set up test environment
3. Begin testing as features land
4. Document all results
5. Create final test report
